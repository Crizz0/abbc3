var bbwizard,requestRunning=!1;!function(r){"use strict";bbwizard=function(e,t){if(!requestRunning){var a=r("#bbcode_wizard"),i=r("#darkenwrapper");if(!a.is(":visible")){requestRunning=!0;var n=phpbb.loadingIndicator();r.ajax({url:e,dataType:"html",beforeSend:function(){a.hide().empty()},success:function(e){i.fadeIn("fast"),a.append(e).fadeIn("fast")},error:function(){bbfontstyle("["+t+"]","[/"+t+"]")},complete:function(){requestRunning=!1,n&&n.is(":visible")&&n.fadeOut(phpbb.alertTime)}})}}};var c=function(e,t){var a;if(is_ie&&((a=document.forms[form_name].elements[text_name]).focus(),baseHeight=document.selection.createRange().duplicate().boundingHeight),insert_text(e+t),is_ie){var i=e+t,n=a.innerHTML.indexOf(i);if(0<n){var o=n+i.length,r=a.createTextRange();r.move("character",o),r.select(),storeCaret(a),a.focus()}}};r(document).ready(function(){var e=r("body");e.on("click",".spoilbtn",function(e){e.preventDefault();var t=r(this),a=t.closest("div").next(".spoilcontent");a.slideToggle("fast",function(){t.text(a.is(":visible")?t.data("hide"):t.data("show"))})});var n=r("#bbcode_wizard"),o=r("#darkenwrapper");e.on("click",function(){n.fadeOut("fast"),o.fadeOut("fast")}),n.on("click","#bbcode_wizard_submit",function(e){e.preventDefault();var t=r(this).data("bbcode");switch(t){case"url":var a=r("#bbcode_wizard_link").val(),i=r("#bbcode_wizard_description").val();c("["+t+(i.length?"="+a:"")+"]"+(i.length?i:a),"[/"+t+"]");break;case"bbvideo":c("[bbvideo]"+r("#bbvideo_wizard_link").val(),"[/bbvideo]")}n.fadeOut("fast"),o.fadeOut("fast")}).on("click","#bbcode_wizard_cancel",function(e){e.preventDefault(),n.fadeOut("fast"),o.fadeOut("fast")}).on("change","#bbvideo_wizard_sites",function(){r("#bbvideo_wizard_example").val(r(this).val())}).click(function(e){e.stopPropagation()})})}(jQuery);