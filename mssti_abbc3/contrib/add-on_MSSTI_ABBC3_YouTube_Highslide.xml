<?xml version="1.0" encoding="utf-8" standalone="yes" ?>
<?xml-stylesheet type="text/xsl" href="modx.prosilver.en.xsl"?>
<!--For security purposes, please check: http://www.phpbb.com/mods/ for the latest version of this MOD. Although MODs are checked before being allowed in the MODs Database there is no guarantee that there are no security problems within the MOD. No support will be given for MODs not found within the MODs Database which can be found at http://www.phpbb.com/mods/-->
<mod xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance" xmlns="http://www.phpbb.com/mods/xml/modx-1.2.5.xsd">
	<header>
		<license><![CDATA[http://opensource.org/licenses/gpl-license.php GNU General Public License v2]]></license>
		<title lang="en"><![CDATA[Advanced BBCode Box 3 (aka ABBC3) - Add-on : Open YouTube videos with Highslide JS]]></title>
		<description lang="en"><![CDATA[This file provides instructions to allow YouTube videos to open with the Highslide JS effect. This will only work for YouTube videos posted using ABBC3's BBVideo bbcode, and is compatible with the standard YouTube url and the shortened youtu.be url.]]></description>
		<author-notes lang="en"><![CDATA[REQUIREMENT - You must have Highslide JS as your chosen Image Resizer in ABBC3's settings page in the ACP.]]></author-notes>
		<author-group>
			<author>
				<realname><![CDATA[Gabriel]]></realname>
				<username><![CDATA[leviatan21]]></username>
				<email><![CDATA[info@mssti.com]]></email>
				<contributions-group>
					<contributions status="current" from="2008-01-10" position="Developer"/>
				</contributions-group>
			</author>
			<author>
				<username><![CDATA[VSE]]></username>
				<contributions-group>
					<contributions status="current" from="2010-03-02" position="Developer"/>
				</contributions-group>
			</author>
		</author-group>

		<mod-version>3.0.10</mod-version>

		<installation>
			<level>easy</level>
			<time>300</time>
			<target-version>3.0.10</target-version>
		</installation>

		<link-group>
			<link type="parent"  href="../install_ABBC3.xml" lang="en">Code change</link>
		</link-group>
	</header>

	<action-group>

		<open src="includes/abbcode.php">
			<edit>
				<find><![CDATA[		/** Patterns and replacements for BBVIDEO bbcode processing **/]]></find>
				<action type="before-add"><![CDATA[		$use_highslide = true; // Open YouTube in Highslide JS? true / false

		global $config;
		$use_highslide = ($config['ABBC3_RESIZE'] && $config['ABBC3_RESIZE_METHOD'] === 'HighslideBox') ? $use_highslide : false;]]></action>
			</edit>
			<edit>
				<find><![CDATA[				'replace'	=> "\$this->auto_embed_video('http://$2youtube.com/v/$5&hl=en&fs=1?rel=0', '{WIDTH}', '{HEIGHT}')",]]></find>
				<action type="replace-with"><![CDATA[				'replace'	=> $use_highslide ? 'HighslideBox' : "\$this->auto_embed_video('http://$2youtube.com/v/$5&hl=en&fs=1?rel=0', '{WIDTH}', '{HEIGHT}')",]]></action>
			</edit>
			<edit>
				<find><![CDATA[				'replace'	=> "\$this->auto_embed_video('http://www.youtube.com/v/$1&feature=youtu.be&hl=en&fs=1?rel=0', '{WIDTH}', '{HEIGHT}')",]]></find>
				<action type="replace-with"><![CDATA[				'replace'	=> $use_highslide ? 'HighslideBox' : "\$this->auto_embed_video('http://www.youtube.com/v/$1&feature=youtu.be&hl=en&fs=1?rel=0', '{WIDTH}', '{HEIGHT}')",]]></action>
			</edit>
			<edit>
				<find><![CDATA[				$video_content = preg_replace($video_data['match'], $video_data['replace'], $in);]]></find>
				<action type="before-add"><![CDATA[				// For youtube in highslide popups
				if ($video_data['replace'] === 'HighslideBox' && ($this->abbcode_config['S_ABBC3_RESIZE'] && $this->abbcode_config['S_ABBC3_RESIZE_METHOD'] === 'HighslideBox'))
				{
					$identifier = preg_match('#http://((.*?)?)youtube.com/(|watch\?)v(/|=)([0-9A-Za-z-_]+)?([^[]*)?#si', $in, $matches) ? $matches[5] : (preg_match('#http://youtu.be/([0-9A-Za-z-_]+)?([^[]*)?#is', $in, $matches) ? $matches[1] : '');							  
					$out = str_replace(
						array('{BBVIDEO_WIDTH}', '{BBVIDEO_HEIGHT}', '{BBVIDEO_LINK}', '{BBVIDEO_ONCLICK}', '{BBVIDEO_IMG}'), 
						array($video_width + 10, $video_height + 10, 'http://www.youtube.com/embed/' . $identifier . '?rel=0&amp;wmode=transparent', "return hs.htmlExpand(this, {objectType: 'iframe', width: " . ($video_width + 10) . ", height: " . ($video_height + 10) . ", allowSizeReduction: false, wrapperClassName: 'draggable-header no-footer', preserveContent: false, objectLoadTime: 'after'})", '<img style="width: 130px; height: 97px; border-radius:5px;" alt="YouTube Video" src="http://img.youtube.com/vi/' . $identifier . '/2.jpg" />'),
						$this->bbcode_tpl('bbvideo_hs')
					);
					break;
				}
]]></action>
			</edit>
		</open>

		<open src="styles/abbcode/abbcode_header.html">
			<edit>
				<find><![CDATA[		//	slideshowGroup: 'gallery',]]></find>
				<action type="before-add"><![CDATA[			slideshowGroup: 'gallery',]]></action>
			</edit>
		</open>

		<open src="styles/prosilver/templates/abbcode.html">
			<edit>
				<find><![CDATA[<!-- BEGIN bbvideo --><div class="bbvideo" style="width: {BBVIDEO_WIDTH}px;"><div class="bbvideotitle">{BBVIDEO_IMAGE}{BBVIDEO_LINK}</div><div class="bbvideocontent">{BBVIDEO_VIDEO}</div></div><!-- END bbvideo -->]]></find>
				<action type="before-add"><![CDATA[<!-- BEGIN bbvideo_hs --><a href="{BBVIDEO_LINK}" onclick="{BBVIDEO_ONCLICK}" class="highslide">{BBVIDEO_IMG}</a><!-- END bbvideo_hs -->]]></action>
			</edit>
		</open>

		<open src="styles/subsilver2/templates/abbcode.html">
			<edit>
				<find><![CDATA[<!-- BEGIN bbvideo --><div class="bbvideo" style="width: {BBVIDEO_WIDTH}px;"><div class="bbvideotitle">{BBVIDEO_IMAGE}{BBVIDEO_LINK}</div><div class="bbvideocontent">{BBVIDEO_VIDEO}</div></div><!-- END bbvideo -->]]></find>
				<action type="before-add"><![CDATA[<!-- BEGIN bbvideo_hs --><a href="{BBVIDEO_LINK}" onclick="{BBVIDEO_ONCLICK}" class="highslide">{BBVIDEO_IMG}</a><!-- END bbvideo_hs -->]]></action>
			</edit>
		</open>

		<diy-instructions lang="en"><![CDATA[You can disable the Highslide effect and revert back to the default embedded video style at any time by changing the $use_highslide variable to false.

#####################################

Open includes/abbcode.php

Find:
$use_highslide = true;

Change to:
$use_highslide = false;

#####################################]]></diy-instructions>

	</action-group>
</mod>